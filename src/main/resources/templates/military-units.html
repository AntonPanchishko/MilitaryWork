<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header('Military Units')"></head>
<body class="container mt-4">
<h2 class="mb-4">Military Units</h2>

<form th:action="@{/ui/save-work-days}" method="post">
    <div class="mb-3">
        <a href="/ui/new-unit" class="btn btn-success">Додати в/сл</a>
        <button type="submit" class="btn btn-primary">Внести зміни</button>
        <a id="editButton" href="#" class="btn btn-warning disabled">Редагувати в/сл</a>
    </div>

    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th></th>
            <th>ID</th>
            <th>Ім'я</th>
            <th>Прізвище</th>
            <th>Всього робочих днів</th>
            <th>Цього тижня</th>
            <th>Відсоток зайобу</th>
            <th>Понеділок</th>
            <th>Вівторок</th>
            <th>Середа</th>
            <th>Четверг</th>
            <th>П'ятниця</th>
            <th>Субота</th>
            <th>Статус</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="unit : ${units}"
            th:classappend="${unit.unitStatus.name() == 'REMOVED'} ? 'table-secondary' :
                             (${unit.unitStatus.name() == 'ON_SICK_LEAVE'} ? 'table-warning' : '')">
            <td>
                <input type="checkbox" name="unitId" th:value="${unit.id}" class="unit-checkbox">
            </td>
            <td th:text="${unit.id}"></td>
            <td th:text="${unit.name}"></td>
            <td th:text="${unit.lastName}"></td>
            <td th:text="${unit.totalWorkDays}"></td>
            <td th:text="${unit.weekWorkDay}"></td>
            <td th:style="|background-color: rgb(255,${255 - (unit.involvingProcent * 2.55)},${255 - (unit.involvingProcent * 2.55)})|"
                th:text="${unit.involvingProcent}"></td>

            <td><input type="checkbox"
                       th:name="'workDays[' + ${unit.id} + '][MONDAY]'"
                       th:checked="${unit.hasWorkDay(T(java.time.DayOfWeek).MONDAY)}"/></td>
            <td><input type="checkbox"
                       th:name="'workDays[' + ${unit.id} + '][TUESDAY]'"
                       th:checked="${unit.hasWorkDay(T(java.time.DayOfWeek).TUESDAY)}"/></td>
            <td><input type="checkbox"
                       th:name="'workDays[' + ${unit.id} + '][WEDNESDAY]'"
                       th:checked="${unit.hasWorkDay(T(java.time.DayOfWeek).WEDNESDAY)}"/></td>
            <td><input type="checkbox"
                       th:name="'workDays[' + ${unit.id} + '][THURSDAY]'"
                       th:checked="${unit.hasWorkDay(T(java.time.DayOfWeek).THURSDAY)}"/></td>
            <td><input type="checkbox"
                       th:name="'workDays[' + ${unit.id} + '][FRIDAY]'"
                       th:checked="${unit.hasWorkDay(T(java.time.DayOfWeek).FRIDAY)}"/></td>
            <td><input type="checkbox"
                       th:name="'workDays[' + ${unit.id} + '][SATURDAY]'"
                       th:checked="${unit.hasWorkDay(T(java.time.DayOfWeek).SATURDAY)}"/></td>

            <td th:text="${unit.unitStatus}"></td>
        </tr>
        </tbody>
    </table>

</form>

<a href="/" class="btn btn-secondary mt-3">На головну</a>

<script>
    const checkboxes = document.querySelectorAll('.unit-checkbox');
    const editButton = document.getElementById('editButton');

    function updateEditButton() {
        const checked = document.querySelectorAll('.unit-checkbox:checked');
        if (checked.length === 1) {
            const id = checked[0].value;
            // ВАЖЛИВО: змінено id -> unitId
            editButton.href = '/ui/edit-unit?unitId=' + id;
            editButton.classList.remove('disabled');
        } else {
            editButton.href = '#';
            editButton.classList.add('disabled');
        }
    }

    // Ініціалізація стану при завантаженні сторінки
    updateEditButton();

    checkboxes.forEach(cb => {
        cb.addEventListener('change', updateEditButton);
    });
</script>

<div th:replace="fragments/footer :: footer"></div>
</body>
</html>
